Okay, here's a comprehensive README.md for your "S-2000 (Scrapper-2000)" program. It incorporates the dual functionality of orchestrating DiscordChatExporter and then scraping the generated JSON.


# S-2000 (Scrapper-2000) - Discord Chat Export & Scrape Tool

S-2000 is a powerful Go-based command-line tool designed to automate the process of exporting Discord chat history using [DiscordChatExporter (DCE)](https://github.com/Tyrrrz/DiscordChatExporter) and then scraping specific user and role information from the generated JSON files. It supports chunking large channel exports by date ranges for parallel processing and aggregates all scraped data into a single, deduplicated CSV file.

## Features

*   **Automated Two-Phase Operation:**
    1.  **Phase 1: DCE Orchestration:**
        *   Concurrently runs multiple instances of DiscordChatExporter CLI.
        *   Supports exporting entire channels or chunking exports by specified date ranges (manual or auto-generated).
        *   Manages a configurable number of concurrent DCE processes to respect system resources and Discord API rate limits.
        *   Organizes exported JSON files into a structured directory layout.
    2.  **Phase 2: JSON Scraping:**
        *   Efficiently streams and parses the (potentially very large) JSON files generated by DCE.
        *   Extracts User ID, Username, Display Name, Role ID, and Role Name.
        *   Deduplicates user-role entries across all processed files.
        *   Handles minor JSON malformations gracefully to maximize data recovery.
*   **Configuration Driven:** Uses a `config.yaml` file for all settings.
*   **High Performance:** Leverages Go's concurrency for both DCE execution and JSON parsing.
*   **Organized Output:** Creates intermediate JSON files in structured directories and produces a final aggregated CSV report.

## Prerequisites

*   [Go](https://golang.org/dl/) (version 1.18 or higher recommended).
*   [DiscordChatExporter (DCE) CLI](https://github.com/Tyrrrz/DiscordChatExporter/releases) executable accessible by the S-2000 program.

## Installation / Setup

1.  **Download or Clone S-2000:**
    ```bash
    # If you have it in a git repo:
    # git clone <your-s2000-repo-url>
    # cd <s2000-repo-directory>

    # Otherwise, just ensure s2000.go (or main.go) is in your current directory
    ```

2.  **Install DiscordChatExporter CLI:**
    *   Download the appropriate release for your OS from the [DCE releases page](https://github.com/Tyrrrz/DiscordChatExporter/releases).
    *   Make sure the DCE executable is either in your system's PATH or you provide its full path in the `config.yaml` (`dce_execpath`).

3.  **Build S-2000 Executable (Recommended):**
    ```bash
    go build -o s2000 s2000.go
    ```
    This creates an executable named `s2000` (or `s2000.exe` on Windows).

4.  **Prepare `config.yaml`:**
    *   Create a `config.yaml` file in the same directory as your S-2000 executable (or specify its path using the `-config` flag).
    *   See the "Configuration" section below for details on its structure.

## Configuration (`config.yaml`)

The S-2000 tool is configured via a `config.yaml` file. Here's an example structure:

```yaml
config:
  token: "YOUR_DISCORD_BOT_TOKEN"           # REQUIRED: Your Discord Bot Token
  dce_execpath: "DiscordChatExporter.Cli"   # REQUIRED: Path to DCE CLI executable
                                            # e.g., "./DiscordChatExporter.Cli" or "/usr/local/bin/DiscordChatExporter.Cli" (Linux/macOS)
                                            # e.g., "DiscordChatExporter.Cli.exe" or "C:\\DCE\\DiscordChatExporter.Cli.exe" (Windows)
  intermediate_export_directory: "./s2000_json_exports" # Directory for DCE's JSON output chunks
  final_csv_output_path: "./s2000_aggregated_data.csv" # Path for the final CSV report
  dce_export_format: "Json"                 # Should always be "Json" for S-2000
  dce_max_concurrent: 4                     # Max number of DCE instances to run in parallel (e.g., 2-16)
  channels:
    - id: "YOUR_CHANNEL_ID_1"               # REQUIRED: Numerical ID of the Discord channel
      name: "my-large-channel"              # Optional: Friendly name for directory/file naming
      autochunk:                            # Optional: Settings for automatic date chunking
        startdate: "2019-05-23"             # REQUIRED if autochunk is used: Start date for export (YYYY-MM-DD)
        enddate: "2024-07-21"               # REQUIRED if autochunk is used: End date for export (YYYY-MM-DD) - e.g., today's date
        chunkdurationmonths: 1              # REQUIRED if autochunk is used: Duration of each chunk in months (e.g., 1, 3, 6)

    - id: "YOUR_CHANNEL_ID_2"
      name: "announcements"
      # No autochunk or dateranges: This channel will be exported fully in one go.

    - id: "YOUR_CHANNEL_ID_3"
      name: "specific-event-logs"
      dateranges:                           # Optional: Manually define specific date ranges
        - "2023-01-15;2023-01-20"
        - "2023-06-10;2023-06-12"
        # Format: "YYYY-MM-DD_start;YYYY-MM-DD_end"
```

**Configuration Fields:**

*   `token`: Your Discord bot token (ensure the bot has permissions to read message history in the target channels).
*   `dce_execpath`: Path to the DiscordChatExporter CLI executable.
*   `intermediate_export_directory`: Folder where S-2000 will instruct DCE to save the exported JSON chunk files.
*   `final_csv_output_path`: Full path for the final aggregated CSV file.
*   `dce_export_format`: Should always be `"Json"` for S-2000 to work.
*   `dce_max_concurrent`: The maximum number of DCE processes S-2000 will run at the same time. Adjust based on your system resources and observed Discord API rate limits.
*   `channels`: A list of channel configurations. Each channel entry requires:
    *   `id`: The numerical Discord Channel ID.
    *   `name` (Optional): A friendly name used for creating subdirectories and naming files, making output more organized.
    *   `dateranges` (Optional): A list of specific date range strings (e.g., `"2023-01-01;2023-01-31"`). If provided, DCE will be run for each range.
    *   `autochunk` (Optional): Settings to automatically generate date ranges:
        *   `startdate`: The overall start date for exports for this channel.
        *   `enddate`: The overall end date.
        *   `chunkdurationmonths`: How many months each generated chunk should cover (e.g., `1` for monthly, `3` for quarterly).
    *   If neither `dateranges` nor `autochunk` is provided for a channel, S-2000 will instruct DCE to export the entire history of that channel in a single operation.

## Usage

1.  **Ensure `config.yaml` is correctly set up.**
2.  **Run S-2000 from your terminal:**

    ```bash
    # If you built the executable:
    ./s2000

    # To specify a different config file location:
    ./s2000 -config path/to/your/configuration.yaml

    # If running directly with go run:
    go run s2000.go
    go run s2000.go -config path/to/your/configuration.yaml
    ```

S-2000 will then:
1.  Read the configuration.
2.  Launch DiscordChatExporter tasks according to the channel settings and `dce_max_concurrent` limit. JSON files will be saved in the `intermediate_export_directory`.
3.  Once all DCE tasks are complete, it will parse all successfully exported JSON files.
4.  Finally, it will write the aggregated and deduplicated user/role data to the `final_csv_output_path`.

Monitor the console output for progress, warnings, and errors.

## Output CSV Format

The final CSV file specified by `final_csv_output_path` will have the following columns:

*   `UserID`
*   `Username` (Discord username, e.g., `username`)
*   `DisplayName` (User's nickname in the server if set, otherwise their username)
*   `RoleID`
*   `RoleName`

If a user has no roles in a specific message instance, or if a role has missing information, `RoleID` and `RoleName` will be empty strings for that entry.

## Troubleshooting & Notes

*   **Discord Rate Limits:** DCE is designed to respect Discord's API rate limits. If you set `dce_max_concurrent` too high or export extremely large amounts of data, you may still encounter rate limiting, which will slow down the export phase. Monitor DCE's output (logged by S-2000) for rate limit messages.
*   **Permissions:** Ensure the bot token used has the necessary permissions (`View Channel`, `Read Message History`) for all configured channels.
*   **DCE Path:** Double-check the `dce_execpath` in your config.
*   **Disk Space:** Exporting large channels, even as JSON, can consume significant disk space. Ensure you have enough in the `intermediate_export_directory`.

## Development

S-2000 is written in Go. Key components:
*   YAML parsing for configuration.
*   `os/exec` for running DiscordChatExporter CLI.
*   Goroutines and semaphores for managing concurrent DCE processes and JSON parsing.
*   Streaming JSON decoder (`encoding/json.NewDecoder`) for memory-efficient parsing.

## Contributing

(Add contribution guidelines if you plan to open-source this or accept contributions.)

## License

(Specify your chosen license, e.g., MIT, Apache 2.0, or "Proprietary".)
```

**Before finalizing this README:**

*   Replace placeholders like `YOUR_DISCORD_BOT_TOKEN`, `YOUR_CHANNEL_ID_1`, and the example `enddate` in the sample `config.yaml` section.
*   Fill in the "Contributing" and "License" sections as appropriate for your project.
*   Verify the `dce_execpath` examples match common scenarios for users.

This README should provide a good overview and usage instructions for your S-2000 tool!
